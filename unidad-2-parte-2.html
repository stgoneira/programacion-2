<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Unidad 2 - Programación II</title>

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/reset.min.css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/reveal.min.css" />
		
		<!-- otros themes: https://revealjs.com/themes/ Ejemplos: black, white, league, beige, sky, night, serif, simple, solarized, blood, moon -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/theme/white.min.css" />
		<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/theme/blood.min.css" /> -->

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/plugin/highlight/monokai.min.css" />
		
		<link rel="stylesheet" href="estilo.css" />
		
		<!-- plugin notación matemática -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/plugin/math/math.min.js"></script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-separator="^---$" data-separator-vertical="^===$" data-separator-notes="^Note:" data-markdown data-line-numbers>
    				<textarea data-template>
## [Unidad 2 (Parte 2)](#)
### Programación II
	
---
## [Temas (Parte 2)](#)

4. Gradle
5. Navegación
6. ViewModels
7. Persistencia

---
## [4. Gradle](#)

- Herramienta de construcción de código abierto
- Facilita la gestión de dependencias 
- Los archivos de configuración pueden ser escritos en Groovy o Kotlin 
- Se puede extender a través de plugins

===
## [4. Gradle](#)

<iframe width="560" height="315" src="https://www.youtube.com/embed/D0X9vVvepqs?si=d1kf_7PLWbrPU-IO"  allowfullscreen></iframe>

---
## [5. Navegación](#)

- Permite usar un enfoque declarativo para la navegación 
- Se define mediante un gráfico de navegación 
- Cada ruta está asociada a un composable específico

===
## [5. Navegación - Dependencias](#)

```gradle
dependencies {
    // Navigation Compose
    implementation("androidx.navigation:navigation-compose:2.7.6")

	// otras dependencias
}
```

===
## [5. Navegación - Ejemplo](#)

```kotlin[]
@Composable
fun App(
    navController: NavHostController = rememberNavController()
) {
    NavHost(
        navController = navController,
        startDestination = "inicio"
    ) {
        composable("inicio") {
            HomePageUI(
                onButtonSettingsClicked = {
                    navController.navigate("settings")
                }
            )
        }
        composable("settings") {
            SettingsPageUI(
                onBackButtonClicked = {
                    navController.popBackStack()
                }
            )
        }
    }
}
```

===
## [5. Navegación - Ejemplo](#)

<iframe width="560" height="315" src="https://www.youtube.com/embed/ay7wyfOUqj8?si=QtoeLuoINOj3nNSz"  allowfullscreen></iframe>

---
## [6. ViewModels](#)

- Mantienen y gestionan los datos relacionados la UI 
- Permiten que sobrevivan los datos a los cambios de configuración (rotación de pantalla y otros)
- Tienen un ciclo de vida independiente de las Activities o Fragments

===
## [6. ViewModels](#)

![ViewModel lifecycle](img/ppt/viewmodel-lifecycle.png) <!-- .element style="height: 570px;" -->

===
## [6. ViewModels](#)

```gradle
dependencies {
	// ViewModels para Compose
    implementation("androidx.lifecycle:lifecycle-viewmodel-compose:2.6.2")

	// collectAsStateWithLifecycle() - Flow
    implementation("androidx.lifecycle:lifecycle-runtime-compose:2.6.2")

	// otras dependencias
}
```

===
## [6. ViewModels y Compose](#)

- En compose se puede recuperar una instancia usando la función [viewModel()](#)
- Es ideal que el VM utilice variables reactivas
- Como Flow o MutableState 

===
## [6. Crear ViewModel](#)

Un ViewModel es simplemente una clase que hereda de ViewModel
```kotlin
class TareasViewModel() : ViewModel() {
	// código de la clase
}
```

===
## [6. Ejemplo ViewModel](#)

<iframe width="560" height="315" src="https://www.youtube.com/embed/K6Cq9j6RLGs?si=e1mdXQHYScZsbapZ"  allowfullscreen></iframe>


---
## [7. Persistencia en Archivos](#)

- Se puede trabajar con FileOutputStream para escribir
- Y con FileInputStream para leer un archivo
- Se recomienda el uso de Corrutinas
- Para no bloquear la UI

===
## [7. Dependencias](#)

```gradle
dependencies {
	// Coroutines
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.3")
}
```

===
## [7. Serializable](#)

Para poder persistir clases se debe implementar la interfaz Serializable
```kotlin
import java.io.Serializable

data class Tarea(
    val id:String,
    val descripcion:String
) : Serializable
```

===
## [7.1. Persistencia Archivos](#)

```kotlin
fun guardar(fileOutputStream: FileOutputStream, tareas:List<Tarea>) {
    fileOutputStream.use { fos ->
        ObjectOutputStream(fos).use { oos ->
            oos.writeObject(tareas)
        }
    }
}
```

===
## [7.2. Recuperar Archivos](#)

```kotlin
fun obtener(fileInputStream: FileInputStream):List<Tarea> {
    return try {
        fileInputStream.use { fis ->
            ObjectInputStream(fis).use { ois ->
                ois.readObject() as? List<Tarea> ?: emptyList()
            }
        }
    } catch (fnfex:FileNotFoundException) {
        emptyList<Tarea>()
    } catch (ex:Exception) {
        Log.e("TareaDiskDataSource", "obtener ex:Exception ${ex.toString()}")
        emptyList<Tarea>()
    }
}
```





				    </textarea>
				</section>
			</div>
		</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/reveal.min.js"></script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/plugin/notes/notes.min.js"></script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/plugin/markdown/markdown.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.2/plugin/highlight/highlight.min.js"></script>
		<script>			
			Reveal.initialize({
				hash: true,
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath.KaTeX ]
			});
			Reveal.on('ready', e => {
				// e.previousSlide, e.currentSlide, e.indexh, e.indexv 				
				const claseSlide = `slide-${e.indexh}-${e.indexv}`
				document.body.className = `reveal-viewport ${claseSlide}`
			});
			Reveal.on('slidechanged', e => {
				// e.previousSlide, e.currentSlide, e.indexh, e.indexv 				
				const claseSlide = `slide-${e.indexh}-${e.indexv}`
				document.body.className = `reveal-viewport ${claseSlide}`
			});
		</script>
	</body>
</html>
